/*
  Copyright (C) 2013 Ahmed Samy <f.fallen45@gmail.com>, MIT.
  Retrive command line arguments and output them to stdout.

  Compile:
     gcc cmd.S
  Run:
     ./a.out 1 2 3
     Should output:
        There are 4 params:
        ./a.out
        1
        2
        3
*/
.data
	output:
		.asciz "There are %d params:\n"

.text
.globl main
main:
	movl 4(%esp), %ecx 	/* Get argument count.  */
	pushl %ecx
	pushl $output
	call printf
	addl $4, %esp 		/* remove output  */

	/* ECX was corrupted by the printf call,
	   pop it off the stack so that we get it's original
	   value.  */
	popl %ecx
	movl 8(%esp), %ebp 	/* Get argv.  */

pr_arg:
	pushl %ecx
	pushl (%ebp)
	call puts
	addl $4, %esp 		/* remove current argument.  */
	addl $4, %ebp

	popl %ecx
	loop pr_arg

	ret